<!DOCTYPE html>
<html class="" lang="en-GB">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="description" content="An easy to use and powerful Web Audio API wrapper for controlling audio on the web" />
    <meta name="keywords" content="audio,web-audio-api,javascript,js,audibly" />
    <title>Audibly | An easy to use and powerful Web Audio API wrapper for controlling audio on the web</title>
    <link rel="stylesheet" type="text/css" href="/css/audibly.css">
</head>
<body class="">
    <main>
        <h1>AudiblyAudioBufferSourceNode</h1>
        <hr>
        <p>Increase playback rate (+0.1) - <a id="buff-playback-inc" href="/#decrease">DO IT</a></p>
        <br>
        <p>Decrease playback rate (-0.1) - <a id="buff-playback-desc" href="/#increase">DO IT</a></p>
        <br>
        <a id="buff-play" href="/#buff-play">PLAY</a> | <a id="buff-stop" href="/#buff-stop">STOP</a>

        <br>
        <br>

        <h1>AudiblyOscillatorNode</h1>
        <hr>
        <p>
            Change wave shape 
            <select id="osc-type">
                <option selected>sine</option>
                <option>square</option>
                <option>sawtooth</option>
                <option>triangle</option>
            </select>
        </p>
        <br>
        <p>Increase frequency (+50) - <a id="osc-freq-inc" href="/#increase">DO IT</a></p>
        <br>
        <p>Decrease frequency (-50) - <a id="osc-freq-dec" href="/#decrease">DO IT</a></p>
       <!--  <p>Increase playback rate (+0.1) - <a id="buff-playback-inc" href="/#decrease">DO IT</a></p>
        <br>
        <p>Decrease playback rate (-0.1) - <a id="buff-playback-desc" href="/#increase">DO IT</a></p>
        <br> -->
        <a id="osc-play" href="/#osc-play">PLAY</a> | <a id="osc-stop" href="/#osc-stop">STOP</a>

    </main>
    <script type="text/javascript" src="/js/audibly.js"></script>
    <script type="text/javascript">

        var sources = {};
        var playback = 0.5;
        
        var audibly = new Audibly({
            audio: [
                {
                    id: 1,
                    url: '/audio/music-loop.wav'
                }
            ],
            callback: function() {
                
                for( var id in this.buffers ) {
                    var buffer = this.buffers[id];

                    var conv = new AudiblyConvolverNode({
                        buffer: buffer,
                        normalise: true
                    });

                    console.log(conv);
                    
                    sources[ id ] = new AudiblyAudioBufferSourceNode({
                        playbackRate: playback,
                        buffer: buffer,
                        loop: false
                    });
                    sources[ id ].connect();
                }

            }
        });

        // AudioBuffer

        document.querySelector('#buff-play').addEventListener('click', function() {
            sources[ 1 ].start(0);
        });

        document.querySelector('#buff-stop').addEventListener('click', function() {
            sources[ 1 ].stop();
        });

        document.querySelector('#buff-playback-inc').addEventListener('click', function() {
            playback += 0.1;
            sources[ 1 ].setPlaybackRate(playback)
        });

        document.querySelector('#buff-playback-desc').addEventListener('click', function() {
            playback -= 0.1;
            sources[ 1 ].setPlaybackRate( playback );
        });

        // Oscillator node

        var frequency = 22000;

        var oscNode = new AudiblyOscillatorNode({
            frequency: frequency,
            type: 'sine'
        });

        console.log(oscNode);

        oscNode.connect();

        document.querySelector('#osc-play').addEventListener('click', function() {
            oscNode.start();
        });

        document.querySelector('#osc-stop').addEventListener('click', function() {
            oscNode.stop();
        });

        document.querySelector('#osc-type').addEventListener('change', function(e) {
            oscNode.setType( this.value );
        });

        document.querySelector('#osc-freq-inc').addEventListener('click', function() {
            frequency += 50;
            oscNode.setFrequency(frequency)
        });

        document.querySelector('#osc-freq-dec').addEventListener('click', function() {
            frequency -= 50;
            oscNode.setFrequency( frequency );
        });

        // Biquad filter node

        var biquad = new AudiblyBiquadFilterNode({
            frequency: frequency,
            type: 'lowpass',
            detune: 18000,
            Q: 3,
            gain: 300
        });

        biquad.connect();

        console.log(biquad);

    </script>
</body>
</html>
